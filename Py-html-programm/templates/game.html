<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #eee;
            padding: 20px;
        }
        .stats, .enemy-stats {
            margin-bottom: 20px;
        }
        .battle-log {
            background-color: #111;
            border: 1px solid #555;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .actions button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
        }
        .dialogue {
            background-color: #333;
            border: 1px solid #666;
            padding: 10px;
            margin-bottom: 20px;
        }
        .disabled {
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>Battle Game</h1>

    <div class="stats">
        <p>HP: {{ hp }} / {{ user.max_hp }}</p>
        <p>Stamina: {{ stamina }} / {{ user.max_stamina }}</p>
        <p>Damage: {{ damage }}</p>
        <p>Armor: {{ armor }}</p>
        <p>Evade: {{ evade }}%</p>
    </div>

    {% if enemy_name %}
    <div class="enemy-stats">
        <h2>Enemy: {{ enemy_name }}</h2>
        <p>HP: {{ enemy_health }}</p>
    </div>
    {% endif %}

    {% if dialogue_mode %}
    <div class="dialogue">
        <p>{{ current_line }}</p>
        <form method="POST">
            <button type="submit" name="action" value="next_line">Next</button>
        </form>
    </div>
    {% else %}
    <div class="actions">
        <form method="POST">
            <button type="submit" name="action" value="attack" {% if stamina < 5 %}disabled class="disabled"{% endif %}>Attack</button>
            <button type="submit" name="action" value="defend">Defend</button>
            <button type="submit" name="action" value="rest">Rest</button>
            <button type="submit" name="action" value="special"
                {% if (user.class == 'hunter' and stamina < 5) or
                       (user.class == 'wizard' and stamina >= user.max_stamina) %}
                disabled class="disabled"{% endif %}>
                Special
            </button>
        </form>
    </div>
    {% endif %}

    <div class="battle-log">
        <h3>Battle Log:</h3>
        {% for line in battle_log %}
            <p>{{ line }}</p>
        {% endfor %}
    </div>

    {% if not enemy_name and not dialogue_mode %}
        <p>You have defeated all enemies!</p>
    {% endif %}
</body>
</html>
